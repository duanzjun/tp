<include file="Public:header" />
<div class="container-fluid">
    <div class="mg-btm10">
        <a class="btn btn-default" href="{:U('User/add')}" title="添加用户">添加用户</a>
    </div>
    <table class="table table-bordered table-hover">
        <thead>
        <tr>
            <th class="text-center"><input type="checkbox" onclick="$('input[name*=\'checked\']').prop('checked', this.checked);" /></th>
            <th>用户名称</th>
            <th>角色名称</th>
            <th>用户描述</th>
            <th>最后登录IP</th>
            <th>最后登录时间</th>
            <th>状态</th>
            <th>操作</th>
        </tr>
        </thead>
        <volist name="lists" id="list">
        <tr>
            <td class="text-center"><input type="checkbox" name="checked[]" value="{$list.id}"</td>
            <td>{$list.username}</td>
            <td>{$role[$list['role']]}</td>
            <td>{$list.remark}</td>
            <td>{$list.last_login_ip}</td>
            <td>{$list.last_login_time|date="Y-m-d H:i",###}</td>
            <td align="center"><span class="d-cursor" d-val="{$list['status']?0:1}" d-uri="{:U('user/ajax_edit',array('id'=>$list['id'],'field'=>'status'))}" onclick="demo_toggle(this)" ><i class="glyphicon <if condition="$list['status'] eq '1'">glyphicon-ok<else/>glyphicon-remove</if>"></i></span></td>
            <td>
            <a href="{:U('User/edit',array('id'=>$list['id']))}" href="#">编辑</a> |
            <a data-toggle="modal" data-target="#delModal" data-uri="{:U('User/del',array('id'=>$list['id']))}" href="#">删除</a></td>
        </tr>
        </volist>
    </table>
    <div class="text-center">{$page}</div>
</div>
<script>
$(function(){
    // $('.is_status').on('click',function(){
    //     var dId = $(this).parent().parent('tr').attr('d-id');
    //     var that = $(this);
    //     var s_val = $(this).attr('data-val') == 1  ? 0 : 1;
    //     $.getJSON('index.php?c=user&a=ajax_edit',{'id':dId,'field':'status','val':s_val},function(data){
    //             if(data.status==true){
    //                 if(data.rel.status==1)
    //                     that.children('i').attr('class','glyphicon glyphicon-ok');
    //                 else
    //                     that.children('i').attr('class','glyphicon glyphicon-remove');
    //                 that.attr('data-val',s_val);
    //             }else
    //                 alert('操作失败！');
    //     });
    // });

    $('.table').on('click','[data-target=#delModal]',function(){
        $('#delModal .modal-dialog').css('width','220');
        var that=$(this);
        $('#delcontent').on('click',function(){
            $.get(that.attr('data-uri'),function(data){
                $('#delModal').modal('hide');
                if(data===true){
                    that.parent().parent().fadeOut('slow',function(){
                        $(this).remove();
                    });
                }else
                    alert('删除失败！');
            });
        });
    });
});
</script>
<!-- delModal -->
<div class="modal fade" id="delModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">关闭</span></button>
        <h4 class="modal-title" id="myModalLabel">消息提示</h4>
      </div>
      <div class="modal-body">确认删除吗？</div>
      <div class="modal-footer">
          <button class="btn btn-primary" id="delcontent" type="button">确定</button>
      </div>
    </div>
  </div>
</div>
<include file="Public:footer" />